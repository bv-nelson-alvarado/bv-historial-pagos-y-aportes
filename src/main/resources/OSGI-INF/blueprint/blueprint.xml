<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:cxf="http://camel.apache.org/schema/blueprint/cxf"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://camel.apache.org/schema/blueprint/cxf http://camel.apache.org/schema/blueprint/cxf/cxf.xsd                   http://camel.apache.org/schema/blueprint  http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">
    <!-- define bean llamada ws -->
    <cxf:rsServer address="/bv" id="historialEndpoint"
        loggingFeatureEnabled="false" serviceClass="cl.bicevida.service.rest.SeviceHistorialPago">
        <cxf:providers>
            <bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider"/>
            <bean
                class="cl.bicevida.service.rest.exception.WebApplicationJsonError" id="exceptionMapper">
                <property name="addMessageToResponse" value="true"/>
            </bean>
        </cxf:providers>
    </cxf:rsServer>
    <camelContext id="_ctxHistorial" xmlns="http://camel.apache.org/schema/blueprint">
        <propertyPlaceholder id="properties" location="classpath:/conf.properties"/>
        <onException>
            <exception>java.lang.Exception</exception>
            <!-- <redeliveryPolicy maximumRedeliveries="3"/> -->
            <handled>
                <constant>true</constant>
            </handled>
            <bean method="exceptionProcess" ref="HistorialProcessResponse"/>
        </onException>
        <route id="_obtenerHistorial">
            <from id="_direct:servicioHistorial" uri="cxfrs:bean:historialEndpoint"/>
            <log id="_obtenerHistorial_1" message="${header.operationName}"/>
            <bean id="_bean1" method="obtenerpagosyaportes" ref="HistorialProcessResponse"/>
            <log id="_obtenerHistorial_2" message="${body}"/>
            <marshal id="_marshal_1">
                <json id="_json_1" library="Jackson"/>
            </marshal>
        </route>
    </camelContext>
    <bean class="cl.bicevida.beans.processors.HistorialProcess" id="HistorialProcessResponse"/>
</blueprint>
